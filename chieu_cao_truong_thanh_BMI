<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chẩn đoán Chiều cao & BMI Trẻ em</title>
  <style>
    body { font-family: Arial; background-color: #e0f7fa; margin: 0; }
    header, footer {
      background-color: #006064; color: white; padding: 10px; text-align: center;
    }
    nav {
      display: flex; justify-content: space-around;
      background: linear-gradient(90deg, #4dd0e1, #00acc1);
      padding: 10px 0;
    }
    nav a {
      color: white; text-decoration: none; font-weight: bold;
    }
    nav a:hover { color: yellow; }
    .container { padding: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 5px; }
    .btn-submit {
      margin-top: 20px; background-color: #00796b;
      color: white; padding: 10px 20px; border: none; cursor: pointer;
    }
    canvas {
      border: 1px solid #ccc; margin-top: 20px; background: #fff;
    }
    .report { background: white; padding: 20px; margin-top: 20px; }
    .form-section {
      background-color: #b2ebf2; padding: 15px; border-radius: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Phòng khám YHTT và YHCT PGS.TS.BS. Võ Tường Kha</h1>
    <p>Web: <a href="http://votuongkha.net" target="_blank" style="color:white">votuongkha.net</a>
    | Tel: 0913504755 | Email: votuongkhabvtt@gmail.com</p>
  </header>
  <nav>
    <a href="http://votuongkha.net">Trang chủ</a>
    <a href="https://forms.gle/mqCBZZnT2nxR43WS8">Dịch vụ</a>
    <a href="https://forms.gle/ikK8uFukM86wxpM46">Đặt lịch</a>
    <a href="tel:0913504755">Liên hệ</a>
  </nav>

  <div class="container">
    <h2>Nhập thông tin chẩn đoán</h2>
    <form id="form" class="form-section">
      <label>Họ tên:</label><input type="text" id="fullName">
      <label>Ngày sinh:</label><input type="date" id="dob">
      <label>Giới tính:</label>
      <select id="gender">
        <option value="boy">Nam</option>
        <option value="girl">Nữ</option>
      </select>
      <label>Địa chỉ:</label><input type="text" id="address">
      <label>Điện thoại:</label><input type="tel" id="phone">
      <label>Email:</label><input type="email" id="email">
      <label>Chiều cao hiện tại (cm):</label><input type="number" id="height">
      <label>Cân nặng hiện tại (kg):</label><input type="number" id="weight">
      <label>Chiều cao của bố (cm):</label><input type="number" id="fatherHeight">
      <label>Chiều cao của mẹ (cm):</label><input type="number" id="motherHeight">
      <label>Ngày kinh đầu tiên:</label><input type="date" id="firstPeriod">
      <label>Chiều cao lúc có kinh đầu tiên (cm):</label><input type="number" id="heightAtPeriod">
      <label>Tuổi xương hiện tại (năm):</label><input type="number" step="0.1" id="boneAge">
      <button type="button" class="btn-submit" onclick="generateReport()">Chẩn đoán</button>
    </form>
    <canvas id="chartCanvas" width="600" height="300"></canvas>
    <div class="report" id="report"></div>
  </div>

  <footer>
    <p>Hà Nội, ngày.......tháng......năm........<br>Bác sỹ khám: PGs.Ts.Bs. Võ Tường Kha</p>
  </footer>

  <script>
    const bangTra = {
      boy: [
        { age: 4, coc: 1.2, cot: -7.3, cotx: 0, hs: 82 },
        { age: 8.5, coc: 1.23, cot: -7, cotx: -0.7, hs: 82 },
        { age: 10, coc: 1.2, cot: -6.2, cotx: -1, hs: 83 },
        { age: 12, coc: 1.08, cot: -4.2, cotx: -2.6, hs: 98 },
        { age: 14, coc: 0.9, cot: -1.4, cotx: -4.5, hs: 113 },
        { age: 16, coc: 0.88, cot: -0.4, cotx: -2.4, hs: 70 },
        { age: 18, coc: 0.97, cot: -0.2, cotx: -1.2, hs: 32 }
      ],
      girl_before: [
        { age: 6, coc: 0.95, cot: -6, cotx: -0.4, hs: 93 },
        { age: 8, coc: 0.92, cot: -4.4, cotx: -1.5, hs: 95 },
        { age: 10, coc: 0.89, cot: -3.2, cotx: -3.2, hs: 104 },
        { age: 12, coc: 0.83, cot: -2.4, cotx: -3.4, hs: 108 },
        { age: 14, coc: 0.91, cot: -1.6, cotx: -2.8, hs: 80 }
      ],
      girl_after: [
        { age: 12, coc: 0.91, cot: -1.4, cotx: -3.2, hs: 81 },
        { age: 14, coc: 0.96, cot: -0.8, cotx: -1.4, hs: 41 },
        { age: 16, coc: 0.99, cot: -0.4, cotx: -0.7, hs: 20 },
        { age: 17.5, coc: 0.99, cot: -0.4, cotx: -0.7, hs: 21 }
      ]
    };

    function làmTrònTuổi(tuoi) {
      const phanThapPhan = tuoi - Math.floor(tuoi);
      if (phanThapPhan <= 0.3) return Math.floor(tuoi);
      if (phanThapPhan < 0.7) return Math.floor(tuoi) + 0.5;
      return Math.ceil(tuoi);
    }

    function traBang(giới_tính, tuổi_làm_tròn, đã_dậy_thì = false) {
      const bảng = giới_tính === 'boy' ? bangTra.boy : (đã_dậy_thì ? bangTra.girl_after : bangTra.girl_before);
      return bảng.reduce((gầnNhất, dòng) => Math.abs(dòng.age - tuổi_làm_tròn) < Math.abs(gầnNhất.age - tuổi_làm_tròn) ? dòng : gầnNhất);
    }

    function generateReport() {
      const fullName = document.getElementById('fullName').value;
      const dob = new Date(document.getElementById('dob').value);
      const now = new Date();
      const age = (now - dob) / (365.25 * 24 * 60 * 60 * 1000);
      const gender = document.getElementById('gender').value;
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('weight').value);
      const fatherHeight = parseFloat(document.getElementById('fatherHeight').value);
      const motherHeight = parseFloat(document.getElementById('motherHeight').value);
      const firstPeriod = document.getElementById('firstPeriod').value;
      const boneAge = parseFloat(document.getElementById('boneAge').value);

      const height_m = height / 100;
      const BMI = weight / (height_m * height_m);
      const heightGen = (fatherHeight + motherHeight) / 2 + (gender === 'boy' ? 6.5 : -6.5);

      const ageRounded = làmTrònTuổi(age);
      const isAfter = gender === 'girl' && firstPeriod;
      const row = traBang(gender, ageRounded, isAfter);
      const heightTX = row.coc * height + row.cot * age + row.cotx * boneAge + row.hs;

      document.getElementById("report").innerHTML = `
        <h3>Kết quả</h3>
        <p><strong>Tuổi:</strong> ${age.toFixed(1)} tuổi</p>
        <p><strong>Chiều cao hiện tại:</strong> ${height} cm</p>
        <p><strong>Chiều cao trưởng thành theo di truyền:</strong> ${heightGen.toFixed(2)} cm</p>
        <p><strong>Chiều cao trưởng thành theo tuổi xương:</strong> ${heightTX.toFixed(2)} cm</p>
        <p><strong>BMI:</strong> ${BMI.toFixed(2)}</p>
        <p><strong>Kết luận:</strong> ...</p>
      `;

      const ctx = document.getElementById("chartCanvas").getContext("2d");
      ctx.clearRect(0, 0, 600, 300);
      ctx.fillStyle = "#00796b";
      ctx.fillRect(50, 300 - height, 50, height);
      ctx.fillText("Hiện tại", 50, 300 - height - 10);
      ctx.fillStyle = "#f57c00";
      ctx.fillRect(150, 300 - heightGen, 50, heightGen);
      ctx.fillText("Di truyền", 150, 300 - heightGen - 10);
      ctx.fillStyle = "#0288d1";
      ctx.fillRect(250, 300 - heightTX, 50, heightTX);
      ctx.fillText("Dự báo TX", 250, 300 - heightTX - 10);
    }
  </script>
</body>
</html>
